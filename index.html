<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sketchfab Configurator</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>

  <body>
    <div class="app">
      <iframe
        src=""
        id="api-frame"
        allowfullscreen
        mozallowfullscreen="true"
        webkitallowfullscreen="true"
        allow="vr"
        width="640"
        height="400"
      ></iframe>
      <div class="options"></div>
    </div>
  </body>

  <script
    type="text/javascript"
    src="https://static.sketchfab.com/api/sketchfab-viewer-1.3.2.js"
  ></script>
  <script type="text/javascript">
    var iframe = document.getElementById("api-frame");
    var uid = "a86f7c2ecee8456e891ea222f04e3134"; // Your model UID
    var client = new Sketchfab("1.12.0", iframe);

    client.init(uid, {
      success: function onSuccess(api) {
        api.start();
        api.addEventListener("viewerready", function () {
          var options = [
            {
              name: "Texture",
              options: [
                {
                  name: "Texture 1",
                  url: "https://i.imgur.com/hVQYxfV.jpg",
                  price: 600,
                },
                {
                  name: "Texture 2",
                  url: "https://i.imgur.com/zIqQ1DD.jpg",
                  price: 900,
                },
                {
                  name: "Texture 3",
                  url: "https://i.imgur.com/dh0kjlT.jpg",
                  price: 1200,
                },
              ],
            },
            {
              name: "Roof",
              options: [
                {
                  name: "FUSION ROOF",
                  selector: '[instance="1100"]',
                  price: 1200,
                },
                {
                  name: "SHED MODERNA",
                  selector: '[instance="983"]',
                  price: 1800,
                },
                {
                  name: "ROOF MODERNA",
                  selector: '[instance="1056"]',
                  price: 2200,
                },
              ],
            },
          ];

          function getSelections() {
            var selections = [];
            options.forEach(function (option) {
              var selectedOption = option.options[option.default || 0];
              selections.push(selectedOption);
            });
            return selections;
          }

          function sendSelectionsToParent() {
            var selections = getSelections();
            window.parent.postMessage(
              { type: "selectionsData", selections: selections },
              "*",
            );
          }

          var optionsContainer = document.querySelector(".options");
          options.forEach(function (option) {
            var selectElement = document.createElement("select");
            selectElement.name = option.name;
            option.options.forEach(function (opt, index) {
              var optionElement = document.createElement("option");
              optionElement.value = index;
              optionElement.textContent = opt.name;
              selectElement.appendChild(optionElement);
            });
            selectElement.addEventListener("change", sendSelectionsToParent);
            optionsContainer.appendChild(selectElement);
          });

          sendSelectionsToParent(); // Initial send
        });
      },
      error: function onError() {
        console.log("Viewer error");
      },
    });
  </script>
</html>
